<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>stomp websocket</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/sockjs-client/1.5.0/sockjs.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/stomp.js/2.3.3/stomp.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.js"></script>
</head>
<body>
    <div id="info"></div>

    <button onclick="connect()">链接</button>
    <button onclick="subscribeSocket()">订阅</button>
    <button onclick="disconnect()">断开</button>
    <button onclick="sendMessageNoParameter()">发送到服务器</button>

    <script type="text/javascript">
        // 设置 STOMP 客户端
        var stompClient = null;
        // 设置 WebSocket 进入端点
        var SOCKET_ENDPOINT = "http://localhost:8003/wsbroker/ws1?access_token=" +
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsiY2xpZW50XzFfcmVzb3VyY2UiXSwidXNlcl9uYW1lIjoiZGVtbyIsInNjb3BlIjpbImFsbCJdLCJleHAiOjE2MDYxOTY0MzIsImF1dGhvcml0aWVzIjpbIlJPTEVfVVNFUiJdLCJqdGkiOiIwY2M3MTUyOS0zMGI3LTQxYTYtYjhlYi1jOWI1M2Q5NWUzYjMiLCJjbGllbnRfaWQiOiJjbGllbnRfMSJ9.h7rTKsmLnWr9d9lKUn1t1XZAfkJ3TKDxLvlhFyh6KkI";
        // 设置订阅消息的请求前缀
        var SUBSCRIBE_PREFIX = "/user/topic";
        // 设置订阅消息的请求地址
        var SUBSCRIBE = "";

        var SEND_ENDPOINT = "/app/read";

        /* 进行连接 */
        function connect() {

            if (stompClient != null && stompClient.connected) {
                alert('链接已存在' + stompClient);
                console.log(stompClient);
                return;
            }


            // 设置 SOCKET
            var socket = new SockJS(SOCKET_ENDPOINT);
            // 配置 STOMP 客户端
            stompClient = Stomp.over(socket);
            // STOMP 客户端连接
            stompClient.connect({}, function (frame) {
                alert("连接成功");
            });
        }

        /* 订阅信息 */
        function subscribeSocket() {
            // 设置订阅地址
            SUBSCRIBE = SUBSCRIBE_PREFIX + '/kelepush';
            // 输出订阅地址
            alert("设置订阅地址为：" + SUBSCRIBE);
            // 执行订阅消息
            stompClient.subscribe(SUBSCRIBE, function (responseBody) {
                var receiveMessage = JSON.parse(responseBody.body);
                console.log(receiveMessage);
                $("#info").append("<tr><td>" + receiveMessage.content + "</td></tr>");
            });
        }

        /* 断开连接 */
        function disconnect() {
            stompClient.disconnect(function () {
                alert("断开连接");
                console.log(stompClient);
            });
        }

        function sendMessageNoParameter() {
            // 设置待发送的消息内容
            var message = '{"targetUser":"' + 'kele' + '", "destination": "' + SUBSCRIBE + '", "content": "' + "我是内容" + '"}';
            // 发送消息
            stompClient.send(SEND_ENDPOINT, {}, message);
        }
    </script>


</body>
</html>
